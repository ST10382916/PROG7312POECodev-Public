@{
    ViewData["Title"] = ViewBag.Title ?? "Issue Submitted Successfully";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Success Header -->
            <div class="text-center mb-5">
                <div class="success-icon mb-4">
                    <i class="fas fa-check-circle fa-5x text-success"></i>
                </div>
                <h1 class="text-success mb-3">Issue Successfully Submitted!</h1>
                <p class="lead text-muted">Thank you for helping improve our community</p>
            </div>

            <!-- Success Details Card -->
            <div class="card border-success mb-4">
                <div class="card-header bg-success text-white text-center">
                    <h4 class="mb-0">
                        <i class="fas fa-ticket-alt me-2"></i>Submission Confirmation
                    </h4>
                </div>
                <div class="card-body text-center">
                    @if (!string.IsNullOrEmpty(ViewBag.SuccessMessage))
                    {
                        <div class="alert alert-success border-0 mb-4">
                            <h5 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>@ViewBag.SuccessMessage
                            </h5>
                        </div>
                    }

                    @if (ViewBag.IssueId != null)
                    {
                        <div class="reference-number mb-4">
                            <h3 class="text-primary mb-2">Reference Number</h3>
                            <div class="reference-id">
                                <span class="badge bg-primary fs-4 px-4 py-3">
                                    #@(((int)ViewBag.IssueId).ToString("D6"))
                                </span>
                            </div>
                            <p class="text-muted mt-2">
                                <i class="fas fa-bookmark me-1"></i>
                                Save this reference number to track your issue
                            </p>
                        </div>
                    }

                    <!-- What Happens Next -->
                    <div class="what-next mb-4">
                        <h5 class="text-dark mb-3">
                            <i class="fas fa-route me-2"></i>What Happens Next?
                        </h5>
                        <div class="row text-center">
                            <div class="col-md-4 mb-3">
                                <div class="step-item">
                                    <div class="step-icon mb-2">
                                        <i class="fas fa-search fa-2x text-warning"></i>
                                    </div>
                                    <h6>1. Review</h6>
                                    <small class="text-muted">
                                        Our team will review your submission within 24 hours
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="step-item">
                                    <div class="step-icon mb-2">
                                        <i class="fas fa-users fa-2x text-info"></i>
                                    </div>
                                    <h6>2. Assign</h6>
                                    <small class="text-muted">
                                        Issue will be assigned to the appropriate department
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="step-item">
                                    <div class="step-icon mb-2">
                                        <i class="fas fa-tools fa-2x text-success"></i>
                                    </div>
                                    <h6>3. Resolve</h6>
                                    <small class="text-muted">
                                        Work will begin to address your reported issue
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="contact-info">
                        <div class="alert alert-light">
                            <h6 class="alert-heading">
                                <i class="fas fa-phone me-2"></i>Need to Follow Up?
                            </h6>
                            <p class="mb-2">
                                You can contact us regarding your issue using your reference number:
                            </p>
                            <div class="row text-center">
                                <div class="col-md-6">
                                    <strong>Phone:</strong> 0860 543 000<br>
                                    <small class="text-muted">Mon-Fri, 8AM-5PM</small>
                                </div>
                                <div class="col-md-6">
                                    <strong>Email:</strong> issues@municipality.gov.za<br>
                                    <small class="text-muted">24/7 support</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="text-center mb-4">
                <a href="@Url.Action("ReportIssue", "Issue")" class="btn btn-primary btn-lg me-3">
                    <i class="fas fa-plus-circle me-2"></i>Report Another Issue
                </a>
                <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary btn-lg">
                    <i class="fas fa-home me-2"></i>Back to Main Menu
                </a>
            </div>

            <!-- Community Impact -->
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h5 class="card-title text-primary">
                        <i class="fas fa-heart me-2"></i>Thank You for Your Civic Engagement!
                    </h5>
                    <p class="card-text">
                        Your report contributes to making our community better. Every issue reported 
                        helps us prioritize improvements and maintain our municipal services effectively.
                    </p>
                    
                    <!-- Encouraging Statistics -->
                    <div class="row mt-3" id="communityStats">
                        <div class="col-md-4">
                            <div class="stat-item">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <h6>Active Citizens</h6>
                                <span class="text-muted" id="activeCitizens">Loading...</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-item">
                                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                <h6>Issues Resolved</h6>
                                <span class="text-muted" id="issuesResolved">Loading...</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-item">
                                <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                                <h6>Avg Response Time</h6>
                                <span class="text-muted">2-3 business days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Social Sharing (Optional) -->
            <div class="text-center mt-4">
                <p class="text-muted mb-2">
                    <i class="fas fa-share-alt me-1"></i>
                    Help spread civic engagement awareness:
                </p>
                <div class="social-buttons">
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="shareOnFacebook()">
                        <i class="fab fa-facebook-f me-1"></i>Share
                    </button>
                    <button class="btn btn-outline-info btn-sm me-2" onclick="shareOnTwitter()">
                        <i class="fab fa-twitter me-1"></i>Tweet
                    </button>
                    <button class="btn btn-outline-success btn-sm" onclick="shareOnWhatsApp()">
                        <i class="fab fa-whatsapp me-1"></i>WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Load community statistics
            loadCommunityStats();
            
            // Auto-copy reference number functionality
            $('.reference-id').click(function() {
                var refNumber = $(this).find('.badge').text();
                navigator.clipboard.writeText(refNumber).then(function() {
                    showTooltip('Reference number copied to clipboard!');
                });
            });
        });
        
        function loadCommunityStats() {
            $.get('@Url.Action("GetEngagementStats", "Issue")')
                .done(function(data) {
                    if (!data.error) {
                        $('#activeCitizens').text(Math.floor(data.totalReports * 1.5) + ' this month');
                        $('#issuesResolved').text(Math.floor(data.totalReports * 0.8) + ' this month');
                    } else {
                        $('#activeCitizens').text('Data unavailable');
                        $('#issuesResolved').text('Data unavailable');
                    }
                })
                .fail(function() {
                    $('#activeCitizens').text('Data unavailable');
                    $('#issuesResolved').text('Data unavailable');
                });
        }
        
        function shareOnFacebook() {
            var message = "I just reported a municipal issue to help improve our community! Join me in making a difference. #CivicEngagement";
            var url = "https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(window.location.href) + "&quote=" + encodeURIComponent(message);
            window.open(url, '_blank', 'width=600,height=400');
        }
        
        function shareOnTwitter() {
            var message = "I just reported a municipal issue to help improve our community! Every citizen can make a difference. #CivicEngagement #CommunityFirst";
            var url = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(message);
            window.open(url, '_blank', 'width=600,height=400');
        }
        
        function shareOnWhatsApp() {
            var message = "I just used our Municipal Services Portal to report an issue in our community. It's so easy to make a difference! Check it out: " + window.location.href;
            var url = "https://wa.me/?text=" + encodeURIComponent(message);
            window.open(url, '_blank');
        }
        
        function showTooltip(message) {
            // Simple tooltip implementation
            var tooltip = $('<div class="alert alert-success position-fixed" style="top: 20px; right: 20px; z-index: 9999;">' + message + '</div>');
            $('body').append(tooltip);
            setTimeout(function() {
                tooltip.fadeOut(function() {
                    tooltip.remove();
                });
            }, 3000);
        }
    </script>
}

@section Styles {
    <style>
        .success-icon {
            animation: pulse 2s infinite;
        }
        
        @@keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .reference-id {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .reference-id:hover {
            transform: scale(1.05);
        }
        
        .step-item {
            padding: 20px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        
        .step-item:hover {
            background-color: #f8f9fa;
        }
        
        .step-icon {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-item {
            padding: 15px;
        }
        
        .social-buttons .btn {
            min-width: 100px;
        }
        
        .card {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .alert {
            border-radius: 8px;
        }
    </style>
}
